<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="assign bugs">
    <meta name="author" content="Li baoxing">

<title>Bugs Admin - Bugs</title>

<!-- Bootstrap Core CSS -->
<link href="/cssv1.0/bootstrap.min.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="/cssv1.0/sb-admin.css" rel="stylesheet">
<link rel="stylesheet" type="text/css"
	href="/scripts/themes/metro/easyui.css" />
<link rel="stylesheet" type="text/css" href="/scripts/themes/icon.css" />
<link rel="stylesheet" type="text/css" href="/css/backend.css" />
<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico" />

<!-- Latest compiled and minified CSS -->
<!-- <link rel="stylesheet"
	href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.css"> -->

<!-- Custom Fonts -->
<link href="/font-awesome/css/font-awesome.min.css" rel="stylesheet"
	type="text/css">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

<body>

    <div id="wrapper">

        <!-- Navigation -->
		<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="index.html">Bug Tracker Admin</a>
			</div>
			<!-- Top Menu Items -->
			<ul class="nav navbar-right top-nav">
				<li class="dropdown"><a href="#" class="dropdown-toggle"
					data-toggle="dropdown"><i class="fa fa-envelope"></i> <b
						class="caret"></b></a>
					<ul class="dropdown-menu message-dropdown">
						<li class="message-preview"><a href="#">
								<div class="media">
									<span class="pull-left"> <img class="media-object" src="http://placehold.it/50x50" alt=""> </span>
									<div class="media-body">
										<h5 class="media-heading">
											<strong>John Smith</strong>
										</h5>
										<p class="small text-muted">
											<i class="fa fa-clock-o"></i> Yesterday at 4:32 PM
										</p>
										<p>Lorem ipsum dolor sit amet, consectetur...</p>
									</div>
								</div>
						</a></li>
						<li class="message-footer"><a href="#">Read All New
								Messages</a></li>
					</ul></li>
				<li class="dropdown"><a href="#" class="dropdown-toggle"
					data-toggle="dropdown"><i class="fa fa-bell"></i> <b
						class="caret"></b></a>
					<ul class="dropdown-menu alert-dropdown">
						<li><a href="#">Alert Name <span
								class="label label-danger">Alert Badge</span></a></li>
						<li class="divider"></li>
						<li><a href="#">View All</a></li>
					</ul></li>
				<li class="dropdown">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" th:if="${fullname}">
						<i class="fa fa-user"></i> 
						<span th:text="${fullname}">Fullname</span>
						<b class="caret"></b>
					</a>
					<ul class="dropdown-menu">
						<li><a href="#"><i class="fa fa-fw fa-user"></i> Profile</a></li>
						<li><a href="#"><i class="fa fa-fw fa-envelope"></i>Inbox</a></li>
						<li class="divider"></li>
						<li><a href="/j_spring_security_logout"><i class="fa fa-fw fa-power-off"></i> Log Out</a></li>
					</ul>
				</li>
			</ul>
			<div class="collapse navbar-collapse navbar-ex1-collapse">
				<ul class="nav navbar-nav side-nav">
					<li>
						<a href="/"><i class="fa fa-fw fa-dashboard"></i>Dashboard</a>
					</li>
					<li class="active">
						<a href="/Bug/assign"><i class="glyphicon glyphicon-tasks"></i> Assign Bugs</a>
					</li>
					<li>
						<a href="/Bug/process"><i class="glyphicon glyphicon-flash"></i> Process Bugs</a>
					</li>
					<li>
						<a href="/Bug/review"><i class="glyphicon glyphicon-refresh"></i> Review Solutions</a>
					</li>
					<li>
						<a href="/Bug/report"><i class="glyphicon glyphicon-list-alt"></i> Bug Reports</a>
					</li>
					<li>
						<a href="javascript:;" data-toggle="collapse" data-target="#demo0">
							<i class="glyphicon glyphicon-menu-hamburger"></i> User Profile<i class="fa fa-fw fa-caret-down"></i>
						</a>
						<ul id="demo0" class="collapse">
							<li><a href="/Auth/user"><i class="fa fa-fw fa-user"></i> User Admin</a></li>
							<li><a href="#"><i class="fa fa-fw fa-cogs"></i> Resource</a></li>
							<li><a href="#"><i class="fa fa-fw fa-random"></i> Group and Permission</a></li>
							<li><a href="#"><i class="fa fa-fw fa-group"></i> Assign Group</a></li>
						</ul>
					</li>
					<li>
						<a href="javascript:;" data-toggle="collapse" data-target="#demo1">
							<i class="glyphicon glyphicon-menu-hamburger"></i> System Admin<i class="fa fa-fw fa-caret-down"></i>
						</a>
						<ul id="demo1" class="collapse">
							<li><a href="#">Product Admin</a></li>
							<li><a href="#">Bug Catalog</a></li>
							<li><a href="#">Mail system</a></li>
						</ul>
					</li>
				</ul>
			</div>
			<!-- /.navbar-collapse -->
		</nav>

        <div id="page-wrapper">

            <div class="container-fluid">

                <!-- Page Heading -->
                <div class="row">
                    <div class="col-lg-12">
<!--                         <h1 class="page-header"> -->
<!--                             Wellcome <small>Have a nice day!</small> -->
<!--                         </h1> -->
                        <ol class="breadcrumb">
                            <li class="active">
                                <li><i class="fa fa-fw fa-dashboard"></i> <a href="/">Dashboard</a></li>
								<li class="active"><i class="glyphicon glyphicon-tasks"></i> Assign Bugs</li>
                            </li>
                        </ol>
                    </div>
                </div>
                <!-- /.row -->
                
				<!-- bug list row -->
				<div class="row">
					<div class="col-lg-12">
						<!-- easyui table for bug list-->
						<table id="dg" class="easyui-datagrid" title="Bug list"
							style="width: auto; height: 335px"
							data-options="
									rownumbers:true,
									singleSelect:true,
									pagination:true,
									url:'/Bug/list?sort=bug_status&order=asc',
									method:'get',
									idField:'id',
									rowStyler:rowStatusBug,
									onSelect: dgselect,
									loadMsg:'',
									toolbar:'#tb'">
							<thead>
								<tr>
									<th data-options="field:'id',width:70">Bug ID</th>
									<th data-options="field:'priority_id',width:70,formatter:formatBugPriority">Priority</th>
									<th data-options="field:'title',width:300">title</th>
									<th data-options="field:'classification',width:100,formatter:formatBugClass">Classification</th>
									<th data-options="field:'product_id',width:100,formatter:formatBugProduct">Product</th>
									<th data-options="field:'product_ver',width:100,formatter:formatBugVersion">Version</th>
									<th data-options="field:'os_id',width:60,formatter:formatBugOS">OS</th>
									<th data-options="field:'creation_ts',width:150">Creation time</th>
									<th data-options="field:'status_id',width:80,formatter:formatBugStatus">Status</th>
								</tr>
							</thead>
						</table>

						<!-- table tool bar-->
						<div id="tb" style="padding: 2px 5px;">
							<div>
								<input id="s-pname" class="easyui-combobox"
									data-options="
							                    valueField: 'id',
							                    textField: 'name',
							                    label:'Product name',
							                    labelWidth: 90,
							                    labelAlign: 'right',
							                    method: 'get',
							                    width: 220,
							                    url:'/Product/namelist',
							                    onSelect:fillVersion,
							                    panelHeight:150"></input>
							    <input id="s-pver" class="easyui-combobox"
									data-options="
							                    valueField: 'text',
							                    textField: 'value',
							                    label:'Product version',
							                    labelWidth: 100,
							                    labelAlign: 'right',
							                    method: 'get',
							                    width: 230,
							                    onSelect:fillOs,
							                    panelHeight:150"></input>
							    <input id="s-pos" class="easyui-combobox"
									data-options="
							                    valueField: 'id',
							                    textField: 'osname',
							                    label:'OS',
							                    labelWidth: 40,
							                    labelAlign: 'right',
							                    method: 'get',
							                    width: 170,
							                    panelHeight:150"></input>
							    <input id="s-status" class="easyui-combobox"
									data-options="
							                    valueField: 'id',
							                    textField: 'desc',
							                    label:'Status',
							                    labelWidth: 60,
							                    labelAlign: 'right',
							                    method: 'get',
							                    width: 170,
							                    url:'/Bug/bugstatuslist',
							                    panelHeight:150"></input>
							    <input id="s-title" class="easyui-textbox" 
									data-options="
												label:'Title',
												labelWidth: 50,
												labelAlign: 'right',
												prompt:'Title like ...',
												width:260,
												onClickButton:search"></input>               
							</div>
							<div style="margin-top:5px">
							    <input id="s-begin" class="easyui-datetimebox"
           							data-options="
           								label:'Start Date',
           								labelWidth: 90,
						                labelAlign: 'right',
						                showSeconds:false, width:220"></input>
           						<input id="s-end" class="easyui-datetimebox"
           							data-options="
           								label:'End Date',
           								labelWidth: 100,
						                labelAlign: 'right',
           								showSeconds:false, 
           								width:230"></input>
           						<input id="s-priority" class="easyui-combobox"
									data-options="
						                    valueField: 'id',
						                    textField: 'desc',
						                    label:'Priority',
						                    labelWidth: 60,
						                    labelAlign: 'right',
						                    method: 'get',
						                    width: 170,
						                    url:'/Bug/bugprioritylist',
						                    panelHeight:150"></input>
           						<input id="s-category" class="easyui-combobox"
									data-options="
						                    valueField: 'id',
						                    textField: 'desc',
						                    label:'Category',
						                    labelWidth: 60,
						                    labelAlign: 'right',
						                    method: 'get',
						                    width: 170,
						                    url:'/Bug/bugclasslist',
						                    panelHeight:150"></input>
								<input id="s-bid" class="easyui-textbox" 
									data-options="
												buttonText:'Search',
												buttonIcon:'icon-search',
												label:'Bug ID',
												labelWidth: 50,
												labelAlign: 'right',
												prompt:'Bug ID...',
												width:260,
												onClickButton:search"></input>							                    							                    
							</div>
						</div>
					</div>
				</div>
				<!-- /.row -->                
                

            </div>
            <!-- /.container-fluid -->

        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- jQuery -->
    <script src="/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/js/bootstrap.min.js"></script>
    
    <script type="text/javascript" src="/scripts/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="/scripts/backend.js"></script>
</body>
<script type="text/javascript">
	var MODEL = '/Bug/assign';
	//
	function fillVersion(record){
		$('#s-pver').combobox({
			url:'/Product/verlist?id='+record.id
		});
	}
	function fillOs(record){
		$('#s-pos').combobox({
			url:'/Product/oslist001?id='+$('#s-pname').combobox('getValue')+'&ver='+record.text
		});
	}
	//clicks earch btn 
	function search() {
		var query = {
			pname : $('#s-pname').combobox('getValue'),
			pver : $('#s-pver').combobox('getValue'),
			pos : $('#s-pos').combobox('getValue'),
			bstatus : $('#s-status').combobox('getValue'),
			btitle : $('#s-title').textbox('getValue'),
			bstart : $('#s-begin').datetimebox('getValue'),
			bend : $('#s-end').datetimebox('getValue'),
			bpriority : $('#s-priority').combobox('getValue'),
			bcategory : $('#s-category').combobox('getValue'),
			bid : $('#s-bid').textbox('getValue')
		};
		$("#dg").datagrid('load', query);
	}

	// click new button
	function add(){
		$('#fm').form('clear');
		$('#username').textbox('readonly',false);
		$('#username').focus();
		console.log('call user add');
	}
	
	// click remove
	function remove(){
		var row = $('#dg').datagrid('getSelected',{});
		if(row==null || row==undefined){
			alert_('Please select a row to delete.');
			return;
		}
		$.messager.confirm('Confirm', 'Are you confirm this?', function(r){
			if (r){
				var url= MODEL + '/delete';
				var data= {"id":Number(row.id), "_method": 'DELETE'};
				var dg= $('#dg');
				console.log(data);
				action(url, data, dg, "POST");
			}
		});
	}
	
	// click save
	function save(){
		var url= MODEL + '/save';
		var data= $('#fm').serializeArray();
		$(data).each(function(){
			// initial value of id
			if(this.name=='status'){
				if(this.value=='on'){
					this.value=1;
				}else{
					this.value=0;
				}
			}
		});
		var dg= $('#dg');
		console.log(data);
		action(url, data, dg, "POST");
	}
	
	$(function() {
		// dynamic bind datagrid
		$('#dg').datagrid({
 			onBeforeLoad : function() {
				// show fullscreen modal windows
				fullScreenMask('open');
			},
			onLoadSuccess : function() {
				// Get this datagrid's panel object
				$(this).datagrid('getPanel')
				// for all easyui-linkbutton <a>'s make them a switchbutton
				.find('input.easyui-switchbutton').switchbutton();
				// bug!! to refreash the value of edit window 
				var row = $('#dg').datagrid('getSelected');
				if (row != null || row != undefined)
					$('#dg').datagrid('selectRecord', row.id);
				$('#w').window('close', true);
			},
			onLoadError : function(XMLHttpRequest) {
				fullScreenMask('close');
				//console.log(XMLHttpRequest);
				ajaxerror(XMLHttpRequest.responseText);
			} 
		});
	});
</script>

</html>
